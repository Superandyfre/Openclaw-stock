# 💰 资金倍数操作功能说明

## ✅ 功能已修复

现在支持"资金翻倍"、"资金扩大N倍"、"资金增加N倍"等命令！

## 🎯 使用方法

### 1. 翻倍（×2）

```
资金翻倍
总资产翻倍
现金翻倍
资金double
资金×2
资金*2
```

**效果**: 总资产变为原来的2倍

**示例**:
```
用户: 资金翻倍
当前: ₩8,800,000

Bot回复:
✅ 资金已翻倍
   原总资产：₩8,800,000
   添加金额：₩8,800,000
   新总资产：₩17,600,000
   可用现金：₩8,800,000 → ₩17,600,000
   持仓价值：₩0
```

### 2. 扩大N倍（×N）

```
资金扩大3倍    → 总资产 × 3
资金变为5倍    → 总资产 × 5
资金扩大10倍   → 总资产 × 10
```

**效果**: 总资产变为原来的N倍

**示例**:
```
用户: 资金扩大3倍
当前: ₩10,000,000

Bot回复:
✅ 资金已扩大3.0倍
   原总资产：₩10,000,000
   添加金额：₩20,000,000
   新总资产：₩30,000,000
   可用现金：₩10,000,000 → ₩30,000,000
```

### 3. 增加N倍（×(1+N)）

```
资金增加1倍    → 总资产 × (1+1) = 总资产 × 2
资金增加2倍    → 总资产 × (1+2) = 总资产 × 3
```

**效果**: 在原有基础上增加N倍（不是变为N倍）

**示例**:
```
用户: 资金增加2倍
当前: ₩10,000,000

Bot回复:
✅ 资金已扩大3.0倍
   原总资产：₩10,000,000
   添加金额：₩20,000,000
   新总资产：₩30,000,000
   可用现金：₩10,000,000 → ₩30,000,000
```

## 🧮 计算逻辑

### 基于总资产倍增

倍数操作会基于**当前总资产**（现金 + 持仓市值）计算：

```
当前总资产 = 可用现金 + 持仓市值
新总资产 = 当前总资产 × 倍数
添加金额 = 新总资产 - 当前总资产

新现金 = 原现金 + 添加金额
新初始资金 = 原初始资金 + 添加金额
```

### 示例对比

**场景**: 当前账户状态
- 可用现金: ₩8,000,000
- 持仓市值: ₩2,000,000  
- 总资产: ₩10,000,000

| 命令 | 倍数 | 新总资产 | 添加金额 | 新现金 |
|------|------|----------|----------|--------|
| 资金翻倍 | ×2 | ₩20,000,000 | +₩10,000,000 | ₩18,000,000 |
| 资金扩大3倍 | ×3 | ₩30,000,000 | +₩20,000,000 | ₩28,000,000 |
| 资金增加1倍 | ×(1+1)=×2 | ₩20,000,000 | +₩10,000,000 | ₩18,000,000 |
| 资金增加2倍 | ×(1+2)=×3 | ₩30,000,000 | +₩20,000,000 | ₩28,000,000 |

## 🔄 与其他资金操作的区别

### 💰 添加固定金额
```
现金添加10000000    →  直接添加1000万
可用资金增加50万    →  添加50万
```

### 🔢 倍数操作
```
资金翻倍            →  按当前总资产翻倍
资金扩大3倍         →  按当前总资产×3
```

### 📝 设置总资产
```
总资产改为5000万    →  总资产设为5000万（重置）
```

## 🧪 测试用例

### 测试1: 纯现金账户翻倍
```
初始状态:
💵 可用现金：₩8,800,000
📈 持仓市值：₩0
💼 总资产：₩8,800,000

命令: 资金翻倍

结果:
💵 可用现金：₩17,600,000  (+₩8,800,000)
📈 持仓市值：₩0
💼 总资产：₩17,600,000
```

### 测试2: 有持仓时翻倍
```
初始状态:
💵 可用现金：₩17,529,837
📈 持仓市值：₩69,988
💼 总资产：₩17,599,825

命令: 资金翻倍

结果:
💵 可用现金：₩35,129,662  (+₩17,599,825)
📈 持仓市值：₩69,988  (不变)
💼 总资产：₩35,199,650  (17,599,825 × 2)
```

## ⚠️ 注意事项

1. **持仓价值不变**: 倍数操作只影响现金，不影响已有持仓
2. **基于总资产**: 计算倍数时包含持仓市值
3. **初始资金同步**: 初始资金会同步增加，保持盈亏准确

## 📱 立即测试

在Telegram Bot中发送：

```
资金翻倍
```

预期返回：
```
✅ 资金已翻倍
   原总资产：₩8,800,000
   添加金额：₩8,800,000
   新总资产：₩17,600,000
   可用现金：₩8,800,000 → ₩17,600,000
   持仓价值：₩0
```

---

**修复完成时间**: 2026-02-22  
**当前Bot状态**: ✅ 运行中 (PID=4571)  
**测试状态**: ✅ 11/12 测试通过
